<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .chat-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .message-box {
            padding: 12px 16px;
            border-radius: 18px;
            margin-bottom: 12px;
            max-width: 70%;
            word-wrap: break-word;
            animation: messageSlide 0.3s ease-out;
            position: relative;
        }
        
        .my-message {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            margin-left: auto;
            text-align: right;
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.3);
        }
        
        .other-message {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            margin-right: auto;
            text-align: left;
            box-shadow: 0 4px 12px rgba(240, 147, 251, 0.3);
        }
        
        .system-message {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            text-align: center;
            margin: 8px auto;
            max-width: 80%;
            box-shadow: 0 2px 8px rgba(79, 172, 254, 0.3);
        }
        
        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .chat-window {
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            border: 1px solid rgba(226, 232, 240, 0.5);
        }
        
        .input-group {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        
        .send-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
        }
        
        .send-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.4);
        }
        
        .status-connected {
            color: #10b981;
            animation: pulse 2s infinite;
        }
        
        .status-disconnected {
            color: #ef4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .typing-indicator {
            display: none;
            padding: 8px 16px;
            background: rgba(102, 126, 234, 0.1);
            border-radius: 18px;
            margin: 8px 0;
            font-style: italic;
            color: #667eea;
        }
        
        .message-time {
            font-size: 0.75rem;
            opacity: 0.8;
            margin-top: 4px;
        }
        
        .message-sender {
            font-weight: 600;
            font-size: 0.875rem;
            margin-bottom: 4px;
        }
        
        .message-content {
            line-height: 1.4;
        }
        
        .scrollbar-hide {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        
        .scrollbar-hide::-webkit-scrollbar {
            display: none;
        }
        
        /* ì…ë ¥ì°½ focus ring ì™„ì „ ì œê±° */
        input:focus {
            outline: none !important;
            box-shadow: none !important;
            border-color: #d1d5db !important;
        }
        
        input:focus-visible {
            outline: none !important;
            box-shadow: none !important;
        }
        
        /* Tailwind focus ring ì™„ì „ ì œê±° */
        input:focus {
            --tw-ring-shadow: none !important;
            --tw-ring-color: transparent !important;
        }
    </style>
</head>
<body class="p-4">

<div class="chat-container rounded-2xl p-8 max-w-4xl mx-auto shadow-2xl">
    <div class="text-center mb-8">
        <h1 class="text-4xl font-bold bg-gradient-to-r from-purple-600 to-blue-600 bg-clip-text text-transparent mb-2">
            ğŸ’¬ ì‹¤ì‹œê°„ ì±„íŒ…
        </h1>
        <p class="text-gray-600">WebSocketì„ í†µí•œ ì‹¤ì‹œê°„ ë©”ì‹œì§•</p>
    </div>

    <div id="chat-window" class="chat-window h-[500px] overflow-y-auto p-6 mb-6 rounded-2xl flex flex-col scrollbar-hide">
        <!-- ë©”ì‹œì§€ë“¤ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
    </div>

    <div class="input-group rounded-2xl p-4">
        <div class="flex space-x-3">
            <input type="text" id="sender-input" value="ìµëª…ì‚¬ìš©ì" 
                   class="flex-1 p-3 border-2 border-gray-200 rounded-xl text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 bg-white/80" 
                   placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”">
            <input type="text" id="message-input" 
                   class="flex-2 p-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-transparent transition-all duration-200 bg-white/80" 
                   placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..." 
                   onkeyup="if(event.key === 'Enter') sendMessage()">
            <button id="send-button" onclick="sendMessage()" 
                    class="send-button text-white font-semibold py-3 px-6 rounded-xl shadow-lg transition-all duration-200 hover:scale-105">
                <span class="flex items-center">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8"></path>
                    </svg>
                    ì „ì†¡
                </span>
            </button>
        </div>
    </div>

    <div id="status" class="mt-6 text-center">
        <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
            <div class="w-2 h-2 rounded-full bg-red-500 mr-2"></div>
            <span class="status-disconnected">ì—°ê²° ëŠê¹€</span>
        </div>
    </div>
</div>

<script>
    // í˜„ì¬ ì ‘ì†í•œ ì‚¬ìš©ìì˜ ì„ì˜ IDë¥¼ ìƒì„± (ì„¸ì…˜ êµ¬ë¶„ì„ ìœ„í•¨)
    const MY_SENDER_ID = 'user-' + Math.random().toString(36).substring(2, 9);

    // ngrokì„ í†µí•œ ê³µê°œ WebSocket ì—°ê²° ì„¤ì •
    const SERVER_HOST = "kourtney-rewirable-fumiko.ngrok-free.dev";
    const protocol = 'wss'; // ngrokì€ HTTPSë¥¼ ì‚¬ìš©í•˜ë¯€ë¡œ ì›¹ì†Œì¼“ì€ WSSë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤
    const endpoint = "/ws/chat"; // Spring Boot ì›¹ì†Œì¼“ ì—”ë“œí¬ì¸íŠ¸ ê²½ë¡œ

    const websocketUrl = `${protocol}://${SERVER_HOST}${endpoint}`;
    console.log("ğŸ”— WebSocket ì—°ê²° ì‹œë„:", websocketUrl);
    
    let websocket;
    let reconnectAttempts = 0;
    const maxReconnectAttempts = 5;
    const reconnectDelay = 3000; // 3ì´ˆ
    let isLoadingHistory = false;
    let historyLoaded = false;
    let historyLoadTimeout;
    let lastMessageTime = Date.now();
    
    function connectWebSocket() {
        try {
            websocket = new WebSocket(websocketUrl);
            setupWebSocketHandlers();
        } catch (error) {
            console.error("âŒ WebSocket ì—°ê²° ìƒì„± ì‹¤íŒ¨:", error);
            showConnectionError("WebSocket ì—°ê²°ì„ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
        }
    }
    
    function setupWebSocketHandlers() {
        // 1. ì—°ê²° ì„±ê³µ ì‹œ
        websocket.onopen = function() {
            console.log("âœ… ì›¹ì†Œì¼“ ì„œë²„ì— ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤. ì£¼ì†Œ:", websocketUrl);
            reconnectAttempts = 0; // ì—°ê²° ì„±ê³µ ì‹œ ì¬ì‹œë„ íšŸìˆ˜ ì´ˆê¸°í™”
            
            statusDiv.innerHTML = `
                <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
                    <div class="w-2 h-2 rounded-full bg-green-500 mr-2 animate-pulse"></div>
                    <span class="status-connected">ì—°ê²° ì„±ê³µ</span>
                </div>
            `;
            
            // íˆìŠ¤í† ë¦¬ ë¡œë”© ì‹œì‘
            isLoadingHistory = true;
            historyLoaded = false;
            console.log("ğŸ“š ì±„íŒ… íˆìŠ¤í† ë¦¬ ë¡œë”© ì‹œì‘...");
            
            // ì±„íŒ…ì°½ ì´ˆê¸°í™” (íˆìŠ¤í† ë¦¬ê°€ ë¡œë“œë  ì˜ˆì •)
            chatWindow.innerHTML = '';
            
            // 1ì´ˆ í›„ íˆìŠ¤í† ë¦¬ ë¡œë”© ì™„ë£Œë¡œ ì„¤ì • (ì´í›„ë¶€í„°ëŠ” ìë™ ìŠ¤í¬ë¡¤ ì•ˆ ë¨)
            setTimeout(() => {
                isLoadingHistory = false;
                historyLoaded = true;
                // ë§ˆì§€ë§‰ìœ¼ë¡œ í•œ ë²ˆ ë” ìŠ¤í¬ë¡¤ì„ ë§¨ ì•„ë˜ë¡œ
                requestAnimationFrame(() => {
                    chatWindow.scrollTop = chatWindow.scrollHeight;
                });
                console.log("ğŸ“š íˆìŠ¤í† ë¦¬ ë¡œë”© ì™„ë£Œ!");
            }, 1000);
            
            // ì²˜ìŒ ì—°ê²° ì‹œ ì…ì¥ ë©”ì‹œì§€ë¥¼ ë³´ëƒ…ë‹ˆë‹¤ (ENTER íƒ€ì…)
            sendControlMessage(senderInput.value, 'ENTER');
        };

        // 2. ë©”ì‹œì§€ ìˆ˜ì‹  ì‹œ
        websocket.onmessage = function(event) {
            const payload = event.data;
            console.log("ğŸ“¨ ë©”ì‹œì§€ ìˆ˜ì‹ :", payload);

            try {
                // ì„œë²„ì—ì„œ ë³´ë‚¸ JSON ë¬¸ìì—´ì„ ê°ì²´ë¡œ ë³€í™˜
                const message = JSON.parse(payload);

                // ì˜¤ë¥˜ ë©”ì‹œì§€ ì²˜ë¦¬
                if (message.error) {
                    displayMessage('System', `ì˜¤ë¥˜: ${message.error}`, 'system');
                    return;
                }

                // ChatMessage DTO í˜•íƒœì˜ ë©”ì‹œì§€ë¥¼ í™”ë©´ì— í‘œì‹œ
                displayMessage(message.sender, message.content, message.type, message.timestamp);
                
                // íˆìŠ¤í† ë¦¬ ë¡œë”© ì¤‘ì—ëŠ” ìŠ¤í¬ë¡¤ì„ ê³„ì† ë§¨ ì•„ë˜ë¡œ ìœ ì§€
                if (isLoadingHistory) {
                    requestAnimationFrame(() => {
                        chatWindow.scrollTop = chatWindow.scrollHeight;
                    });
                }

            } catch (e) {
                console.error("âŒ ìˆ˜ì‹  ë©”ì‹œì§€ íŒŒì‹± ì˜¤ë¥˜:", e);
                console.error("ë¬¸ì œê°€ ëœ ì›ë³¸ ë°ì´í„°:", payload);
                // ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” í‘œì‹œí•˜ì§€ ì•Šê³  ë¡œê·¸ë§Œ ë‚¨ê¹€
            }
        };

        // 3. ì—°ê²° ë‹«í˜ ì‹œ
        websocket.onclose = function(event) {
            console.log("âŒ ì›¹ì†Œì¼“ ì—°ê²°ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì½”ë“œ:", event.code, "ì´ìœ :", event.reason);
            
            // ì •ìƒì ì¸ ì¢…ë£Œê°€ ì•„ë‹Œ ê²½ìš°ì—ë§Œ ì¬ì—°ê²° ì‹œë„
            if (event.code !== 1000 && reconnectAttempts < maxReconnectAttempts) {
                reconnectAttempts++;
                console.log(`ğŸ”„ ì¬ì—°ê²° ì‹œë„ ${reconnectAttempts}/${maxReconnectAttempts}`);
                
                statusDiv.innerHTML = `
                    <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
                        <div class="w-2 h-2 rounded-full bg-yellow-500 mr-2 animate-pulse"></div>
                        <span class="text-yellow-600">ì¬ì—°ê²° ì‹œë„ ì¤‘... (${reconnectAttempts}/${maxReconnectAttempts})</span>
                    </div>
                `;
                
                setTimeout(() => {
                    connectWebSocket();
                }, reconnectDelay);
            } else {
                statusDiv.innerHTML = `
                    <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
                        <div class="w-2 h-2 rounded-full bg-red-500 mr-2"></div>
                        <span class="status-disconnected">ì—°ê²° ëŠê¹€</span>
                    </div>
                `;
                showConnectionError("ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•´ì£¼ì„¸ìš”.");
            }
        };

        // 4. ì˜¤ë¥˜ ë°œìƒ ì‹œ
        websocket.onerror = function(error) {
            console.error("âŒ ì›¹ì†Œì¼“ ì˜¤ë¥˜ ë°œìƒ:", error);
            
            if (reconnectAttempts < maxReconnectAttempts) {
                reconnectAttempts++;
                console.log(`ğŸ”„ ì˜¤ë¥˜ í›„ ì¬ì—°ê²° ì‹œë„ ${reconnectAttempts}/${maxReconnectAttempts}`);
                
                statusDiv.innerHTML = `
                    <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
                        <div class="w-2 h-2 rounded-full bg-yellow-500 mr-2 animate-pulse"></div>
                        <span class="text-yellow-600">ì¬ì—°ê²° ì‹œë„ ì¤‘... (${reconnectAttempts}/${maxReconnectAttempts})</span>
                    </div>
                `;
                
                setTimeout(() => {
                    connectWebSocket();
                }, reconnectDelay);
            } else {
                statusDiv.innerHTML = `
                    <div class="inline-flex items-center px-4 py-2 rounded-full text-sm font-medium">
                        <div class="w-2 h-2 rounded-full bg-red-500 mr-2"></div>
                        <span class="status-disconnected">ì˜¤ë¥˜ ë°œìƒ</span>
                    </div>
                `;
                showConnectionError("ì„œë²„ì— ì—°ê²°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ì„œë²„ê°€ ì‹¤í–‰ ì¤‘ì¸ì§€ í™•ì¸í•´ì£¼ì„¸ìš”.");
            }
        };
    }
    
    // DOM ìš”ì†Œë“¤
    const chatWindow = document.getElementById('chat-window');
    const messageInput = document.getElementById('message-input');
    const senderInput = document.getElementById('sender-input');
    const statusDiv = document.getElementById('status');

    // WebSocket ì—°ê²° ì‹œì‘
    connectWebSocket();

    // ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜ (TALK íƒ€ì…)
    function sendMessage() {
        if (websocket.readyState === WebSocket.OPEN) {
            const sender = senderInput.value || 'ìµëª…';
            const content = messageInput.value.trim();

            if (content === "") return;

            // ì„œë²„ì˜ ChatMessage DTOì— ë§ê²Œ ê°ì²´ ìƒì„±
            const chatMessage = {
                sender: sender,
                content: content,
                type: "TALK" // ì¼ë°˜ ì±„íŒ… ë©”ì‹œì§€ íƒ€ì…
                // IDì™€ timestampëŠ” ì„œë²„ì—ì„œ ì²˜ë¦¬ë©ë‹ˆë‹¤.
            };

            // ê°ì²´ë¥¼ JSON ë¬¸ìì—´ë¡œ ë³€í™˜(ì§ë ¬í™”)í•˜ì—¬ ì „ì†¡í•©ë‹ˆë‹¤.
            websocket.send(JSON.stringify(chatMessage));

            // ì…ë ¥ì°½ ì´ˆê¸°í™”
            messageInput.value = '';
            messageInput.focus();
        } else {
            alertMessage('ì›¹ì†Œì¼“ ì—°ê²°ì´ ëŠì–´ì¡ŒìŠµë‹ˆë‹¤.');
        }
    }

    // ì œì–´ ë©”ì‹œì§€ ì „ì†¡ í•¨ìˆ˜ (ENTER, LEAVE ë“±)
    function sendControlMessage(senderName, type) {
        if (websocket.readyState === WebSocket.OPEN) {
            const message = {
                sender: senderName,
                content: type === 'ENTER' ? `${senderName} ë‹˜ì´ ì…ì¥í–ˆìŠµë‹ˆë‹¤.` : `${senderName} ë‹˜ì´ ë‚˜ê°”ìŠµë‹ˆë‹¤.`,
                type: type
            };
            websocket.send(JSON.stringify(message));
        }
    }

    // ì‹œê°„ í˜•ì‹ì„ 'ì˜¤í›„ 7:58' í˜•íƒœë¡œ ë³€í™˜í•˜ëŠ” ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜
    function formatTime(timestamp) {
        if (!timestamp) return '';

        let date;
        try {
            // Spring Bootì—ì„œ LocalDateTimeì´ 'YYYY-MM-DDTHH:MM:SS.SSS' í˜•íƒœì˜ ë¬¸ìì—´ë¡œ ì „ì†¡ë¨
            if (typeof timestamp === 'string') {
                date = new Date(timestamp);
            } else {
                date = new Date(timestamp);
            }
        } catch (e) {
            return '';
        }

        if (isNaN(date.getTime())) {
            return '';
        }

        const hours = date.getHours();
        const minutes = date.getMinutes().toString().padStart(2, '0');
        const ampm = hours >= 12 ? 'ì˜¤í›„' : 'ì˜¤ì „';
        const displayHours = hours % 12 || 12; // 0ì‹œë¥¼ 12ì‹œë¡œ í‘œì‹œ

        return `${ampm} ${displayHours}:${minutes}`;
    }

    // ë©”ì‹œì§€ í™”ë©´ ì¶œë ¥ í•¨ìˆ˜
    function displayMessage(sender, content, type, timestamp) {
        const messageElement = document.createElement('div');
        const senderId = senderInput.value; // í˜„ì¬ ì‚¬ìš©ìì˜ ë‹‰ë„¤ì„

        // ë©”ì‹œì§€ íƒ€ì…ì— ë”°ë¥¸ ìŠ¤íƒ€ì¼ ë° ë‚´ìš© ê²°ì •
        if (type === 'ENTER' || type === 'LEAVE') {
            messageElement.className = 'message-box system-message';
            messageElement.innerHTML = `
                <div class="message-content">${content}</div>
            `;
        } else {
            // ì¼ë°˜ ëŒ€í™” ë©”ì‹œì§€
            const isMyMessage = sender === senderId; // ë‹‰ë„¤ì„ìœ¼ë¡œ íŒë‹¨

            messageElement.className = `message-box ${isMyMessage ? 'my-message' : 'other-message'}`;
            messageElement.innerHTML = `
                <div class="message-sender">${sender}</div>
                <div class="message-content">${content}</div>
                <div class="message-time">${formatTime(timestamp)}</div>
            `;
        }

        chatWindow.appendChild(messageElement);
        
        // íˆìŠ¤í† ë¦¬ ë¡œë”©ì´ ì™„ë£Œëœ ê²½ìš°ì—ë§Œ ìë™ ìŠ¤í¬ë¡¤
        // (íˆìŠ¤í† ë¦¬ ë¡œë”© ì¤‘ì—ëŠ” ìŠ¤í¬ë¡¤í•˜ì§€ ì•ŠìŒ)
        if (!isLoadingHistory || historyLoaded) {
            // ì•½ê°„ì˜ ì§€ì—°ì„ ë‘ê³  ìŠ¤í¬ë¡¤í•˜ì—¬ DOM ì—…ë°ì´íŠ¸ë¥¼ ê¸°ë‹¤ë¦¼
            setTimeout(() => {
                chatWindow.scrollTop = chatWindow.scrollHeight;
            }, 10);
        }
    }

    // ì—°ê²° ì˜¤ë¥˜ ë©”ì‹œì§€ í‘œì‹œ í•¨ìˆ˜
    function showConnectionError(message) {
        chatWindow.innerHTML = `
            <div class="flex items-center justify-center h-full">
                <div class="text-center">
                    <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
                        <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
                        </svg>
                    </div>
                    <p class="text-red-600 font-medium">${message}</p>
                    <p class="text-gray-500 text-sm mt-2">í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•˜ê±°ë‚˜ ì„œë²„ ìƒíƒœë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.</p>
                    <div class="mt-4 space-x-2">
                        <button onclick="location.reload()" class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors">
                            ìƒˆë¡œê³ ì¹¨
                        </button>
                        <button onclick="connectWebSocket()" class="px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-colors">
                            ì¬ì—°ê²°
                        </button>
                    </div>
                </div>
            </div>
        `;
    }

    // ê°„ë‹¨í•œ ì»¤ìŠ¤í…€ ì•Œë¦¼ ë©”ì‹œì§€ í•¨ìˆ˜
    function alertMessage(message) {
        // ê¸°ì¡´ alert() ëŒ€ì‹  ì‚¬ìš©í•  ê°„ë‹¨í•œ í‘œì‹œ
        const tempAlert = document.createElement('div');
        tempAlert.className = 'fixed top-4 right-4 bg-gradient-to-r from-yellow-400 to-orange-400 text-white p-4 rounded-xl shadow-2xl z-50 transition-all duration-300 transform';
        tempAlert.innerHTML = `
            <div class="flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L3.732 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                </svg>
                ${message}
            </div>
        `;
        document.body.appendChild(tempAlert);
        
        // ì• ë‹ˆë©”ì´ì…˜ íš¨ê³¼
        setTimeout(() => {
            tempAlert.style.transform = 'translateX(100%)';
            tempAlert.style.opacity = '0';
        }, 2500);
        
        setTimeout(() => tempAlert.remove(), 3000);
    }

    // ì°½ì„ ë‹«ì„ ë•Œ ë‚˜ê°€ëŠ” ë©”ì‹œì§€ ì „ì†¡
    window.addEventListener('beforeunload', () => {
        sendControlMessage(senderInput.value, 'LEAVE');
        websocket.close();
    });
</script>

</body>
</html>
